<!DOCTYPE html>
<html>
<head>
    <!--
    * Author:         Moonsea
    -->
    <meta charset="utf-8" />
    <title>Ecshop 开发问题汇总 | Moonsea's Blog</title>
    <meta name="author" content="Moonsea" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="Moonsea's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="https://help.github.com/assets/images/site/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
    
</head>
<body>

    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">Moonsea</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="https://github.com/moonsea/" target="_blank" style="margin-left:-5px;"><img src="https://www.icinga.org/wp-content/uploads/2014/07/github_logo.png" alt="" width="25"/></a>
            <a href="http://www.cnblogs.com/moonseazj/" target="_blank" style="margin-left:5px;"><img src="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcQpVif04zTTXD3oM8ZSWaJUfxVoiZMb2C9gQQxpdq4AsRxOiU08" alt="" width="25"/></a>
            <a href="Mailto:seainsight@126.com" target="_blank" style="margin-left:5px;"><img src="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcTgzheMdNlWeo7lx4-Tj95yGSJ9bHbSasD8A3BIiMFTutf2SasVaQ" alt="" width="25"/></a>
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/Ecshop-Problems" title="Ecshop 开发问题汇总">Ecshop 开发问题汇总</a></h1>
        <p class="entry-date">2016-04-05</p>
        <h2 id="section">写在前面</h2>

<p>本文记录在Ecshop开发和使用过程中遇到的各种问题以及解决方法</p>

<h2 id="gdversion">安装时提示：<code>gd_version()</code></h2>

<p>找到install/includes/lib_installer.php中的第31行<code>return ls_image::gd_version();</code>然后在找到include/cls_image.php中的678行，发现<code>gd_version()</code>方法未声明静态static，所以会出错</p>

<p>问题： 安装Ecshop时，出现错误提示信息<code>Strict Standards: Non-static method cls_image::gd_version() should not be called statically</code>
<img src="/images/ecshopproblems/16-04-05-1-gd-version.JPG" alt="Gd-Version" /></p>

<p>方案： 下面两种方法选择一种即可</p>

<ul>
  <li>将function gd_version()改成static function gd_version()即可</li>
  <li>或者将install/includes/lib_installer.php中的第31行return cls_image::gd_version();改成：</li>
</ul>

<blockquote>
  <p>$p = new cls_image();
   return $p-&gt;gd_version();</p>
</blockquote>

<h2 id="jepg">JEPG显示不支持</h2>

<p>查看发现有libjpeg.lib库，GD2库也有，都加载了，也都正常。查看ecshop源代码发现install/includes/lib_installer.php中第98行,JPEG写成了JPG</p>

<p>问题： 环境检测显示JEPG不支持
<img src="/images/ecshopproblems/16-04-05-2-jepg-unsuport.JPG" alt="jpeg-unsupport" /></p>

<p>方案：将第98行代码改成如下形式</p>

<pre><code>$jpeg_enabled = ($gd_info['JPEG Support']        === true) ? $_LANG['support'] : $_LANG['not_support'];
</code></pre>

<h2 id="pregreplace">错误警告<code>preg_replace()</code></h2>

<p>安装Ecshop完成之后，访问前台页面，会提示警告信息<code> Deprecated: preg_replace(): The /e modifier is deprecated</code></p>

<p>问题： 错误警告<code> Deprecated: preg_replace(): The /e modifier is deprecated</code>
<img src="/images/ecshopproblems/16-04-05-3-preg-replace.JPG" alt="Preg-Replace" /></p>

<p>方案： 打开<code>includes\cls_template.php</code>,跳转到第<code>300</code>行，将</p>

<pre><code>return preg_replace("/{([^\}\{\n]*)}/e", "\$this-&gt;select('\\1');", $source);
</code></pre>

<p>替换成</p>

<pre><code>return preg_replace_callback("/{([^\}\{\n]*)}/", function($r) { return $this-&gt;select($r[1]); }, $source);
</code></pre>

<p>重新访问页面就解决了</p>

<h2 id="only-variables">错误警告：<code>Only variables</code></h2>

<p>安装完成之后，访问前台首台，出现警告信息<code>Strict standards: Only variables should be passed by reference</code></p>

<p>问题：错误警告<code>Strict standards: Only variables should be passed by reference</code>
<img src="/images/ecshopproblems/16-04-05-4-only-variable.JPG" alt="Only-Variable" /></p>

<p>方案：PHP 5.3以上版本的问题，和配置有关.只要<code>includes\cls_template.php</code>第<code>418</code>行</p>

<pre><code>$tag_sel = array_shift(explode(' ', $tag));
</code></pre>

<p>拆成两句就没有问题了</p>

<pre><code>$tag_arr = explode(' ', $tag);
$tag_sel = array_shift($tag_arr);
</code></pre>

<p>或者直接修改PHP配置文件<code>php.ini</code>第<code>451</code>行，将</p>

<pre><code>error_reporting = E_ALL
</code></pre>

<p>改成</p>

<pre><code>error_reporting = E_ALL
</code></pre>

<p>重新启动服务即可</p>

<h2 id="ecshopmktime">Ecshop后台<code>mktime()</code>错误警告</h2>

<p>安装完成之后，登录系统后台访问“商店设置”时，系统报错，提示<code>mktime(): You should be using the time() function instead in</code>.这是因为PHP版本的问题，<code>mktime()</code>不带参数被调用时，会被提示错误.</p>

<p>问题：错误警告<code>mktime(): You should be using the time() function instead in</code>
<img src="/images/ecshopproblems/16-04-05-5-mktime.JPG" alt="Mktime" /></p>

<p>方案：根据错误提示找到相应错误所在的文件，并且定位到问题代码，将</p>

<pre><code>$auth = mktime();
</code></pre>

<p>替换成</p>

<pre><code>$auth = time();
</code></pre>

<p>刷新页面就可以了</p>

<h2 id="section-1">参考资料</h2>

<p>[1]<a href="http://www.cnblogs.com/thinksasa/archive/2013/03/12/2955922.html">Ecshop安装过程中的的问题：cls_image::gd_version()和不支持JPEG</a><br />
[2]<a href="http://www.cnblogs.com/wallis0922/archive/2012/12/08/2808199.html">安装Ecshop首页出现报错：Only variables should be passed by referen</a></p>


        <div id="disqus_thread"></div>
        <script>
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//httpmoonseagithubio.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

    <div class="sidenav">
        <h2>Blog</h2>
        <ul class="artical-list">
        
            <li><a href="/Build-Github-Pages">使用 Github 搭建自己的博客</a></li>
        
            <li><a href="/My-Fisrt-Blog">我的第一篇 Blog</a></li>
        
        </ul>

        <h2>Opinion</h2>
        <ul class="artical-list">
        
            <li><a href="/Review-Survey">如何写一篇Survey的Review</a></li>
        
        </ul>

        <h2>Project</h2>
        <ul class="artical-list">
        
            <li><a href="/Ecshop-Problems">Ecshop 开发问题汇总</a></li>
        
            <li><a href="/Centos-Php">CentOs搭建Php开发环境</a></li>
        
            <li><a href="/Nodejs-P2pspider">p2pspider(读写文件和Mongodb版)</a></li>
        
            <li><a href="/CentOs-aria2">CentOs 安装多线程下载工具</a></li>
        
            <li><a href="/Wabacus-Problems">Wabacus 开发问题汇总</a></li>
        
        </ul>
    </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>
    

    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74981935-1', 'auto');
      ga('send', 'pageview');
    </script>

</body>
</html>
